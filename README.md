# MAVLink 测试台

基于 Rust + egui 开发的 MAVLink 协议测试工具，支持消息收发测试、多种连接方式和配置管理。

## 功能概览

- **发送测试**：选择 MAVLink 消息类型，配置字段值和发送频率，支持多消息并发发送
- **接收检测**：实时统计接收消息数量、频率，查看消息字段详情
- **多连接方式**：TCP 客户端/服务器、UDP 双向/单向、串口
- **配置管理**：保存/加载测试配置，方便复用

## 界面说明

### 顶部工具栏

| 按钮 | 功能 |
|------|------|
| 📂 加载XML | 加载 MAVLink XML 定义文件 |
| 🔌 连接设备 | 打开连接配置对话框 |
| ▶ 开始发送 / ⏹ 停止发送 | 控制消息发送 |
| 💾 保存配置 | 保存当前测试配置 |
| 📁 加载配置 | 加载已保存的配置 |

### 三个标签页

1. **📤 发送测试**
  - 左侧：消息列表，勾选添加到发送队列
  - 右侧：已选消息的发送配置（频率、字段值、启用状态）

2. **📥 接收检测**
  - 左侧：按接收数量排序的消息统计
  - 右侧：点击消息查看 Header 和字段详情

3. **📋 运行日志**
  - 连接状态、发送统计、错误信息

## 连接配置

| 类型 | 参数 | 说明 |
|------|------|------|
| TCP Client | 主机 + 端口 | 主动连接远端 |
| TCP Server | 监听端口 | 等待远端连接 |
| UDP | 主机 + 端口 + 本地端口 | 双向通信 |
| UDP In | 监听端口 | 仅接收 |
| UDP Out | 主机 + 端口 | 仅发送 |
| Serial | 串口 + 波特率 | 串口通信 |

所有连接均需配置 System ID（默认255）和 Component ID（默认0）。

## 使用流程

```
1. 加载 MAVLink XML 定义文件
       ↓
2. 配置连接参数 → 点击连接
       ↓
3. 在发送测试页勾选消息 → 编辑字段值
       ↓
4. 点击"开始发送"
       ↓
5. 在接收检测页查看回传数据
```

## 消息字段编辑

点击消息卡片的「✏ 编辑」按钮：

- **Header 设置**：可自定义 system_id / component_id
- **发送频率**：0.1 ~ 100 Hz
- **字段值**：
  - 数值类型：直接输入数字
  - 枚举类型：下拉选择
  - 数组类型：逗号分隔（如 `1.0, 2.0, 3.0`）
  - 字符串类型：直接输入文本

## 配置文件

配置保存在程序目录下的 `config/` 文件夹：

```
config/
├── app.json          # 应用配置（XML路径等）
└── records/          # 测试记录
    └── *.json
```

## 依赖说明

- `eframe` / `egui`：GUI 框架
- `mavlink`：MAVLink 协议解析
- `serialport`：串口通信
- `crossbeam-channel`：线程通信
- `chrono`：时间处理
- `rfd`：文件选择对话框

## 构建

```bash
cargo build --release
```

生成的可执行文件位于 `target/release/` 目录。